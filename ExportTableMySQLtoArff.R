library(RMySQL)
library(foreign)

path <- "~/EXPORTARFF/"
projects <- c("tomcat", "derby", "glibc", "httpd", "xen", "kernel", "mozilla")
metrics <- c("CountLine","CountLineCode","CountLineCodeExe","CountLineCodeDecl","CountLineBlank","CountStmt","CountStmtExe","CountStmtDecl","Cyclomatic","CyclomaticModified","CyclomaticStrict","CountSemicolon","MaxNesting","Knots","Essential","MaxEssentialKnots","MinEssentialKnots","CountPath","CountLineComment","RatioCommentToCode","CountInput","CountOutput")

for(project in projects){
  con <- dbConnect(MySQL(), user = 'root', password = 'admin', host = '127.0.0.1', dbname='software')
  vulnerable_query <- paste("SELECT * FROM software.FUNCTIONS_affected_",project,sep = "")
  neutral_query <- paste("SELECT * FROM software.FUNCTIONS_neutral_",project,sep = "")
  print(vulnerable_query)
  vulnerable_table_frame <- dbGetQuery(con,vulnerable_query)
  print(neutral_query)
  neutral_table_frame <- dbGetQuery(con,neutral_query)
  dbDisconnect(con)
  
  all <- rbind(vulnerable_table_frame,neutral_table_frame)
  #all$CountDeclFunction <- all$CountDeclMethod
  #all$CountLinePreprocessor <- 0
  
  #write.arff(all, paste(path,project,"_functions_unbalanced.arff",sep = ''))
  
  output<-data.frame(row.names = c("media","mediana"))
  all <- subset(all, select = metrics)
  for(metric in colnames(all)){
    median <- median(all[,metric])
    mean <- mean(all[,metric])
    output["media",metric] <- mean
    output["mediana",metric] <- median
  }
  write.csv(output, paste(path,project,"_statistic.csv",sep = ''))
}