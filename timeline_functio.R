library(RMySQL)

metric <- "Metrics value"

query <- "SELECT P.RELEASES, P.DATE, F.* FROM software.PATCHES AS P,software.FUNCTIONS_1_dom as F, software.EXTRA_TIME_FUNCTIONS as T where F.NameMethod='PreCreate(nsISupports*#commaJSContext*#commaJSObject*#commaJSObject**)' and F.FilePath='dom/base/nsDOMClassInfo.cpp' and F.ID_Function = T.ID_Function and P.P_ID = T.P_ID ORDER BY P.DATE, F.Occurrence desc;"

con <- dbConnect(MySQL(), user = 'root', password = 'admin', host = 'localhost', dbname='software')
timeline <- dbGetQuery(con,query)
dbDisconnect(con)

#srow.names(timeline) <- timeline

title=paste(metric,"timeline", sep="_")
path_image=paste("~/Temp_Graf_R/",title,".pdf",sep="")
pdf(path_image)
plot(timeline$CountLineCode,type = "o", ylab = metric, xlab = "Time", ylim = c(0,max(c(timeline$CountLineCode,timeline$CountInput,timeline$Cyclomatic))))
par(new = TRUE)
plot(timeline$CountInput, type = "o", col = "darkblue", axes = FALSE, ann = FALSE, ylim = c(0,max(c(timeline$CountLineCode,timeline$CountInput,timeline$Cyclomatic))))
par(new = TRUE)
plot(timeline$Cyclomatic, type = "o", col = "red", axes = FALSE, ann = FALSE, ylim = c(0,max(c(timeline$CountLineCode,timeline$CountInput,timeline$Cyclomatic))))
legend("bottomleft",  fill = c("black","darkblue", "red"), c("CountLineCode","CountInput","Cyclomatic"), cex = 1.0, bty = "n", x.intersp = 0.2);
#abline(v = 125)
#abline(v = 135)
dev.off()
