library(RMySQL)

metric <- "Metrics value"

#query <- "SELECT P.RELEASES, P.DATE, F.* FROM software.PATCHES AS P,software.FUNCTIONS_1_dom as F, software.EXTRA_TIME_FUNCTIONS as T where F.NameMethod='PreCreate(nsISupports*#commaJSContext*#commaJSObject*#commaJSObject**)' and F.FilePath='dom/base/nsDOMClassInfo.cpp' and F.ID_Function = T.ID_Function and P.P_ID = T.P_ID ORDER BY P.DATE, F.Occurrence desc;"
query <- "SELECT DISTINCT P.RELEASES, P.DATE, F.* FROM software.PATCHES AS P, software.FUNCTIONS_2_net as F, software.EXTRA_TIME_FUNCTIONS as T where F.NameMethod='nr_recvmsg(structkiocb*#commastructsocket*#commastructmsghdr*#commasize_t#commaint)' and F.FilePath='net/netrom/af_netrom.c' and F.ID_Function = T.ID_Function and P.P_ID = T.P_ID group by F.ID_Function ORDER BY P.DATE, F.Occurrence desc;"

con <- dbConnect(MySQL(), user = 'root', password = 'admin', host = 'localhost', dbname='software')
dbGetQuery(con,"SET sql_mode = '';")
timeline <- dbGetQuery(con,query)
dbGetQuery(con,"SET sql_mode = 'only_full_group_by';")
dbDisconnect(con)

#srow.names(timeline) <- timeline

title=paste(metric,"timeline", sep="_")
path_image=paste("~/Temp_Graf_R/",title,".pdf",sep="")
pdf(path_image,  width=12.5, height=7)
plot(timeline$CountLine,type = "o", ylab = metric, xlab = "Patches", ylim = c(-10,max(c(timeline$CountLine,timeline$CountPath,timeline$CountStmt,timeline$RatioCommentToCode,timeline$CountOutput,timeline$Knots))))
par(new = TRUE)
plot(timeline$CountPath, type = "o", col = "darkblue", axes = FALSE, ann = FALSE, ylim = c(-10,max(c(timeline$CountLine,timeline$CountPath,timeline$CountStmt,timeline$RatioCommentToCode,timeline$CountOutput,timeline$Knots))))
par(new = TRUE)
plot(timeline$CountStmt, type = "o", col = "red", axes = FALSE, ann = FALSE, ylim = c(-10,max(c(timeline$CountLine,timeline$CountPath,timeline$CountStmt,timeline$RatioCommentToCode,timeline$CountOutput,timeline$Knots))))
legend("bottomleft",  fill = c("black","darkblue", "red"), c("CountLine","CountPath","CountStmt"), cex = 1.0, bty = "n", x.intersp = 0.2);



par(new = TRUE)
plot(timeline$RatioCommentToCode, type = "o", col = "yellow", axes = FALSE, ann = FALSE, ylim = c(-10,max(c(timeline$CountLine,timeline$CountPath,timeline$CountStmt,timeline$RatioCommentToCode,timeline$CountOutput,timeline$Knots))))

par(new = TRUE)
plot(timeline$CountOutput, type = "o", col = "green", axes = FALSE, ann = FALSE, ylim = c(-10,max(c(timeline$CountLine,timeline$CountPath,timeline$CountStmt,timeline$RatioCommentToCode,timeline$CountOutput,timeline$Knots))))

par(new = TRUE)
plot(timeline$Knots, type = "o", col = "pink", axes = FALSE, ann = FALSE, ylim = c(-10,max(c(timeline$CountLine,timeline$CountPath,timeline$CountStmt,timeline$RatioCommentToCode,timeline$CountOutput,timeline$Knots))))

legend("bottomright",  fill = c("yellow","green", "pink"), c("RatioCommentToCode","CountOutput","Knots"), cex = 1.0, bty = "n", x.intersp = 0.2);
abline(v = 3, col = "grey")
abline(v = 21,  col = "grey")
dev.off()

