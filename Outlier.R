library(RMySQL)

projects<-c('glibc','httpd','xen','derby','tomcat','kernel','mozilla')
projects<-c('glibc','httpd','xen','derby','tomcat')

path<-"/home/rique/Temp_Results_R/"
dir.create(path,recursive = TRUE)
setwd(path)

metrics <- c("CountLine","CountLineCode","CountLineCodeExe","CountLineCodeDecl","CountLineBlank","CountStmt","CountStmtExe","CountStmtDecl","Cyclomatic","CyclomaticModified","CyclomaticStrict","CountSemicolon","MaxNesting","Knots","Essential","MaxEssentialKnots","MinEssentialKnots","CountPath","CountLineComment","RatioCommentToCode","CountInput","CountOutput","Affected")
#metrics <- c("CountLine", "CountStmt", "CyclomaticStrict", "MaxEssencialKnots", "RatioCommentToCode,CountLineCodeDecl", "CountLineBlank", "CountStmtDecl", "MaxNesting", "Knots", "CountPath", "CountInput", "CountOutput", "Affected")

output <- data.frame(row.names = projects)
for(project in projects){
  print(project)
  
  con <- dbConnect(MySQL(), user = 'root', password = 'admin', host = '127.0.0.1', dbname='software')
  df <- dbGetQuery(con, paste("SELECT * FROM software.FUNCTIONS_neutral_",project,sep = ''))
  df <- rbind(df,dbGetQuery(con, paste("SELECT * FROM software.FUNCTIONS_affected_",project,sep = '')))
  df <- subset(df, select = metrics)
  ##eliminando duplicados
  #only_metrics <- df
  #only_metrics$Affected <- NULL
  #df <- df[!duplicated(only_metrics),]
  #rm(only_metrics)
  #gc()
  dbDisconnect(con)
  
  number <- 0
  for(metric in metrics){
    outliers <- boxplot.stats(df[,metric])$out
    number <- number + length(outliers)
  }
  output[project,"outliers"] <- number
  output[project,"total"] <- length(df$CountLine) * length(metrics)
}

write.csv(output, paste(path,"outliers_each_project",".csv",sep = ''))

