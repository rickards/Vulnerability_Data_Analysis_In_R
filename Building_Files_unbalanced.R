library(RMySQL)
library(foreign)

funcao <- function(project,metrics)
{
  con <- dbConnect(MySQL(), user = 'root', password = 'admin', host = '127.0.0.1', dbname='software')
  vulnerable_query <- paste("SELECT * FROM software.FILES_affected_",project,sep = "")
  neutral_query <- paste("SELECT * FROM software.FILES_neutral_",project,sep = "")
  print(vulnerable_query)
  vulnerable_table_frame <- dbGetQuery(con,vulnerable_query)
  print(neutral_query)
  neutral_table_frame <- dbGetQuery(con,neutral_query)
  dbDisconnect(con)
    
  vulnerable_table_frame <- subset(vulnerable_table_frame, select = metrics)
  neutral_table_frame <- subset(neutral_table_frame, select = metrics)
    
  all <- rbind(vulnerable_table_frame,neutral_table_frame)

  neutral_table_frame<-NULL
  vulnerable_table_frame<-NULL
  
  all$CountDeclFunction <- all$CountDeclClassMethod
  all$CountLinePreprocessor <- 0
  
  return(all)
  
}

path <- "~/DatasetsComparableTechiniques/"
metrics <- c("AvgCyclomatic","AvgCyclomaticStrict","AvgLine","AvgLineCode","CountLineBlank","CountLineCodeDecl","CountLineComment","CountStmt","MaxCyclomaticModified","MaxEssential","RatioCommentToCode","SumCyclomaticModified","SumEssential","AvgCyclomaticModified","AvgEssential","AvgLineBlank","AvgLineComment","CountDeclClass","CountLine","CountLineCode","CountLineCodeExe","CountSemicolon","CountStmtDecl","CountStmtExe","MaxCyclomatic","MaxCyclomaticStrict","MaxNesting","SumCyclomatic","SumCyclomaticStrict","CountPath","FanIn","FanOut","AvgFanIn","AvgFanOut","MaxFanIn","MaxFanOut","AvgMaxNesting","SumMaxNesting","MaxMaxNesting","HK","DIT","NOC","CBC","RFC","CBO","LCOM","Affected")
metrics <- c("AvgCyclomatic", "AvgCyclomaticModified", "AvgCyclomaticStrict", "AvgEssential", "AvgLine", "AvgLineBlank", "AvgLineCode", "AvgLineComment", "CountDeclClass", "CountDeclClassMethod", "CountDeclClassVariable", "CountDeclFunction", "CountDeclInstanceMethod", "CountDeclInstanceVariable", "CountDeclMethod", "CountDeclMethodPrivate", "CountDeclMethodProtected", "CountDeclMethodPublic", "CountLine", "CountLineBlank", "CountLineCode", "CountLineCodeDecl", "CountLineCodeExe", "CountLineComment", "CountSemicolon", "CountStmt", "CountStmtDecl", "CountStmtExe", "MaxCyclomatic", "MaxCyclomaticModified", "MaxCyclomaticStrict", "MaxEssential", "MaxNesting", "RatioCommentToCode", "SumCyclomatic", "SumCyclomaticModified", "SumCyclomaticStrict", "SumEssential", "CountPath", "FanIn", "FanOut", "AvgFanIn", "AvgFanOut", "MaxFanIn", "MaxFanOut", "AvgMaxNesting", "SumMaxNesting", "MaxMaxNesting", "HK", "DIT", "NOC", "CBC", "RFC", "CBO", "LCOM","Affected")
project <- "tomcat"
unbalanced <- funcao(project,metrics)
unbalanced<-unbalanced[sample(nrow(unbalanced)),]
write.arff(unbalanced, paste(path,"FILEs","_Unbalanced.arff",sep = ''), relation = "file")