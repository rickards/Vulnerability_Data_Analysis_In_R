library(RMySQL)

projects <- c("derby","tomcat","glibc","httpd","xen","kernel","mozilla")
metrics <- c("CountInput","CountLine","CountLineBlank","CountLineCode","CountLineCodeDecl","CountLineCodeExe","CountLineComment","CountOutput","CountPath","CountSemicolon","CountStmt","CountStmtDecl","CountStmtExe","Cyclomatic","CyclomaticModified","CyclomaticStrict","Essential","Knots","MaxEssentialKnots","MaxNesting","MinEssentialKnots","RatioCommentToCode")

vulnerable_dataset <- NULL
neutral_dataset <- NULL

df <- data.frame()

for(project in projects){
  con <- dbConnect(MySQL(), user = 'root', password = 'admin', host = 'localhost', dbname='software')
  vulnerable_query <- paste("SELECT * FROM software.FUNCTIONS_affected_",project,sep = "")
  neutral_query <- paste("SELECT * FROM software.FUNCTIONS_neutral_",project,sep = "")
  print(vulnerable_query)
  vulnerable_table_frame <- dbGetQuery(con,vulnerable_query)
  print(neutral_query)
  neutral_table_frame <- dbGetQuery(con,neutral_query)
  dbDisconnect(con)
  
  vulnerable_table_frame <- subset(vulnerable_table_frame, select = metrics)
  neutral_table_frame <- subset(neutral_table_frame, select = metrics)
  
  for(metric in metrics){
    ttest <- t.test(vulnerable_table_frame [,metric],neutral_table_frame [,metric])
    df[metric,project] <- ttest$p.value
  }
}
write.csv(df, paste("~/Temp_Graf_R/","analysis","_ttests",".csv",sep = ''))