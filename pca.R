library(RMySQL)
library(vegan)
library(rgl)

projects<-c('glibc','httpd','xen','derby','tomcat','kernel','mozilla')
projects<-c('glibc','httpd','xen','derby','tomcat')

path<-"/home/rique/Temp_Results_R/"
dir.create(path,recursive = TRUE)
setwd(path)

#metrics <- c("CountLine","CountLineCode","CountLineCodeExe","CountLineCodeDecl","CountLineBlank","CountStmt","CountStmtExe","CountStmtDecl","Cyclomatic","CyclomaticModified","CyclomaticStrict","CountSemicolon","MaxNesting","Knots","Essential","MaxEssentialKnots","MinEssentialKnots","CountPath","CountLineComment","RatioCommentToCode","CountInput","CountOutput","Affected")
#metrics <- c("CountLine", "CountStmt", "CyclomaticStrict", "MaxEssencialKnots", "RatioCommentToCode,CountLineCodeDecl", "CountLineBlank", "CountStmtDecl", "MaxNesting", "Knots", "CountPath", "CountInput", "CountOutput", "Affected")
metrics <- c("CountLine","CountLineCodeDecl","CountLineBlank","CountStmt","CountStmtDecl","CyclomaticStrict","MaxNesting","Knots","MaxEssentialKnots","CountPath","RatioCommentToCode","CountInput","CountOutput","Affected")


for(project in projects){
  print(project)
  
  con <- dbConnect(MySQL(), user = 'root', password = 'admin', host = '127.0.0.1', dbname='software')
  df <- dbGetQuery(con, paste("SELECT * FROM software.FUNCTIONS_neutral_",project,sep = ''))
  df <- rbind(df,dbGetQuery(con, paste("SELECT * FROM software.FUNCTIONS_affected_",project,sep = '')))
  df <- subset(df, select = metrics)
  #eliminando duplicados
  only_metrics <- df
  only_metrics$Affected <- NULL
  df <- df[!duplicated(only_metrics),]
  rm(only_metrics)
  gc()
  dbDisconnect(con)
  
  pca <- prcomp(df[,-14], scale=T)
  print(pca)
}
