library(RMySQL)

dir.create(paste("~/Temp_Graf_R/",sep=""),recursive = TRUE)

projects <- c("derby","tomcat","glibc","httpd","xen","kernel","mozilla")
metrics <- c("CountInput","CountLine","CountLineBlank","CountLineCode","CountLineCodeDecl","CountLineCodeExe","CountLineComment","CountOutput","CountPath","CountSemicolon","CountStmt","CountStmtDecl","CountStmtExe","Cyclomatic","CyclomaticModified","CyclomaticStrict","Essential","Knots","MaxEssentialKnots","MaxNesting","MinEssentialKnots","RatioCommentToCode")

vulnerable_dataset <- NULL
neutral_dataset <- NULL

for(project in projects){
  con <- dbConnect(MySQL(), user = 'root', password = 'admin', host = 'localhost', dbname='software')
  vulnerable_query <- paste("SELECT * FROM software.FUNCTIONS_affected_",project,sep = "")
  neutral_query <- paste("SELECT * FROM software.FUNCTIONS_neutral_",project,sep = "")
  print(vulnerable_query)
  vulnerable_table_frame <- dbGetQuery(con,vulnerable_query)
  print(neutral_query)
  neutral_table_frame <- dbGetQuery(con,neutral_query)
  dbDisconnect(con)
  
  vulnerable_table_frame <- subset(vulnerable_table_frame, select = metrics)
  neutral_table_frame <- subset(neutral_table_frame, select = metrics)
  
  vulnerable_dataset <- rbind(vulnerable_dataset, vulnerable_table_frame)
  neutral_dataset <- rbind(neutral_dataset, neutral_table_frame)
}

neutral_table_frame<-NULL
vulnerable_table_frame<-NULL

vulnerable_dataset<-data.frame(vulnerable_dataset)
neutral_dataset<-data.frame(neutral_dataset)

temp <- cor(vulnerable_dataset,vulnerable_dataset, method="spearman")
write.csv(temp, paste("~/Temp_Graf_R/","correlation_vuln_spearman_",".csv",sep = ''))
temp <- cor(neutral_dataset,neutral_dataset, method="spearman")
write.csv(temp, paste("~/Temp_Graf_R/","correlation_neutral_spearman_",".csv",sep = ''))