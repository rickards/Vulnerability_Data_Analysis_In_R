library(RMySQL)
library(plotrix)
library(beanplot)

dir.create(paste("~/Temp_Graf_R/",sep=""),recursive = TRUE)

projects <- c("derby","tomcat","glibc","httpd","xen","kernel","mozilla")
metrics <- c("CountInput","CountLine","CountLineBlank","CountLineCode","CountLineCodeDecl","CountLineCodeExe","CountLineComment","CountOutput","CountPath","CountSemicolon","CountStmt","CountStmtDecl","CountStmtExe","Cyclomatic","CyclomaticModified","CyclomaticStrict","Essential","Knots","MaxEssentialKnots","MaxNesting","MinEssentialKnots","RatioCommentToCode")

dataset <- NULL

for(project in projects){
  con <- dbConnect(MySQL(), user = 'root', password = 'admin', host = 'localhost', dbname='software')
  vulnerable_query <- paste("SELECT * FROM software.FUNCTIONS_affected_",project,sep = "")
  neutral_query <- paste("SELECT * FROM software.FUNCTIONS_neutral_",project,sep = "")
  print(vulnerable_query)
  vulnerable_table_frame <- dbGetQuery(con,vulnerable_query)
  print(neutral_query)
  neutral_table_frame <- dbGetQuery(con,neutral_query)
  dbDisconnect(con)
  
  vulnerable_table_frame <- subset(vulnerable_table_frame, select = metrics)
  neutral_table_frame <- subset(neutral_table_frame, select = metrics)
  
  dataset <- rbind(dataset, c(paste(project,"vulnerable",sep = "_"),vulnerable_table_frame))
  dataset <- rbind(dataset, c(paste(project,"neutral",sep = "_"),neutral_table_frame))
}

neutral_table_frame<-NULL
vulnerable_table_frame<-NULL

dataset<-data.frame(dataset)

for(metric in metrics){
  title=paste(metric,"boxplot", sep="_")
  path_image=paste("~/Temp_Graf_R/",title,".pdf",sep="")
  pdf(path_image)
  
  boxplot(cex.axis=0.8,dataset[,metric],outline=FALSE,
          names = c("V","N","V","N","V","N","V","N","V","N","V","N","V","N"),
          xlab="  Derby      Tomcat      Glibc        Httpd       Xen HV     Kernel     Mozilla")
  
  dev.off()
}

for(metric in metrics){
  if(metric=="Essential") next
  title=paste(metric,"beanplot", sep="_")
  path_image=paste("~/Temp_Graf_R/",title,".pdf",sep="")
  pdf(path_image)
  
  #https://stat.ethz.ch/R-manual/R-devel/library/stats/html/bandwidth.html
  beanplot(cex.axis=0.8,dataset[,metric],bw="nrd0",#bw = "SJ-dpi"
           names = c("V","N","V","N","V","N","V","N","V","N","V","N","V","N"),
           xlab="  Derby      Tomcat      Glibc        Httpd       Xen HV     Kernel     Mozilla")
  
  dev.off()
}
